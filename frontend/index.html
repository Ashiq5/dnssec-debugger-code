<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>DNSSEC Debugger Web</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 700px; margin: 2rem auto; }
      textarea, input { width: 100%; padding: .5rem; margin: .5rem 0; }
      pre { background: #f5f5f5; padding: 1rem; border-radius: 6px; white-space: pre-wrap; }
      button { padding: .5rem 1rem; cursor: pointer; }
    </style>
  </head>
  <body>
    <h1>Run Debugger</h1>
    <form id="form">
      <label>Domain:</label>
      <input id="domain" placeholder="example.com" required />
      <button type="submit">Submit</button>
    </form>

    <h3>Instructions</h3>
    <pre id="output"></pre>

    <h3>History (latest 20)</h3>
    <div id="history"></div>

    <script>
      const form = document.getElementById('form');
      const output = document.getElementById('output');
      const historyDiv = document.getElementById('history');

      async function loadHistory() {
        const res = await fetch('/history');
        const data = await res.json();
        historyDiv.innerHTML = data.map(r =>
          `<pre><b>${r.domain}</b>\n${r.status}\nðŸ•’ ${r.created_at}\nðŸ•’ ${r.completed_at}</pre>`
        ).join('');
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const domain = document.getElementById('domain').value;
        output.textContent = 'Processing...';
        const res = await fetch('/run', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ domain })
        });
        const data = await res.json();
        output.textContent = data.output;
        loadHistory();
      });

      loadHistory();
    </script>
  </body>
</html>
